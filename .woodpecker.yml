# https://woodpecker-ci.org/docs/usage/intro
pipeline:

  build_and_test:
    image: rust
    commands:
      - cargo build --release
      - cargo test --release

  gitea_release:
    # http://plugins.drone.io/drone-plugins/drone-gitea-release/
    image: plugins/gitea-release
    files: target/release/reel-moby
    secrest: [api_key, base_url]
    when
      tag: test*

  notify:
    # http://plugins.drone.io/appleboy/drone-discord/
    image: appleboy/drone-discord
    secrets: [ discord_webhook_id, discord_webhook_token]
    message: "build {{build.number}} failed. Fix me please."
    when:
      status: failure
